var meister=angular.module("meister",["ngMaterial","ngAnimate","ngSanitize","ngMessages","ngAria","ui.router","ngCookies","md.data.table","chart.js"]);meister.constant("SERVER_BASE_URL","http://localhost:8000/api"),function(e){e.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"LoginController"}).state("home",{url:"/",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("about",{url:"/about",templateUrl:"partials/about-partial.html",controller:"AboutController"}).state("claims",{url:"/claims",templateUrl:"partials/claims-partial.html",controller:"ClaimsController",params:{filters:[]}}).state("sales_order",{url:"/SalesOrder",templateUrl:"partials/sales-order-partial.html",controller:"SalesOrderController",params:{filters:[]}}).state("reports",{url:"/reports",templateUrl:"partials/reports-partial.html",controller:"ReportsController",params:{filters:[]}}).state("claim-details",{url:"/claims-details",templateUrl:"partials/claim-details-partial.html",controller:"ClaimDetailsController",params:{claimno:""}}).state("reports-summary",{url:"/reports-summary",templateUrl:"partials/reports-summary-partial.html",controller:"ReportSummaryController",params:{PKY:"",reportName:""}})}]).run(["$rootScope","$location","$cookieStore","$http",function(e,t,o,a){e.globals=o.get("globals")||{},e.globals.currentUser&&(a.defaults.headers.common.Authorization="Basic "+e.globals.currentUser.authdata),e.$on("$locationChangeStart",function(o,a,r){"/login"===t.path()||e.globals.currentUser||t.path("/")})}])}(meister),function(e){e.factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout",function(e,t,o,a,r){var i={};return i.Login=function(e,t,o){r(function(){var a={success:"arosenthal"===e&&"Pa55word."===t};a.success||(a.message="Username or password is incorrect"),o(a)},1e3)},i.SetCredentials=function(r,i){var n=e.encode(r+":"+i);a.globals={currentUser:{username:r,authdata:n}},t.defaults.headers.common.Authorization="Basic "+n,o.put("globals",a.globals)},i.ClearCredentials=function(){a.globals={},o.remove("globals"),t.defaults.headers.common.Authorization="Basic "},i}]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var o,a,r,i,n,l="",s="",c="",u=0;do{o=t.charCodeAt(u++),a=t.charCodeAt(u++),s=t.charCodeAt(u++),r=o>>2,i=(3&o)<<4|a>>4,n=(15&a)<<2|s>>6,c=63&s,isNaN(a)?n=c=64:isNaN(s)&&(c=64),l=l+e.charAt(r)+e.charAt(i)+e.charAt(n)+e.charAt(c),o=a=s="",r=i=n=c=""}while(u<t.length);return l},decode:function(t){var o,a,r,i,n,l="",s="",c="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=e.indexOf(t.charAt(u++)),i=e.indexOf(t.charAt(u++)),n=e.indexOf(t.charAt(u++)),c=e.indexOf(t.charAt(u++)),o=r<<2|i>>4,a=(15&i)<<4|n>>2,s=(3&n)<<6|c,l+=String.fromCharCode(o),64!=n&&(l+=String.fromCharCode(a)),64!=c&&(l+=String.fromCharCode(s)),o=a=s="",r=i=n=c=""}while(u<t.length);return l}}})}(meister),function(e){e.factory("apiUtils",["$http","SERVER_BASE_URL",function(e,t){var o=t,a=function(e,t,a,r){var i={};return i.method=e,i.url=o+t,i.params=a||{},r&&(i.data=r),i},r={};return r.get=function(t,o,r){var i=a("GET",t,o,null);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.post=function(t,o,r){var i=a("POST",t,null,o);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.put=function(t,o,r){var i=a("PUT",t,null,o);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.del=function(t,o,r){var i=a("DELETE",t,o,r);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r}])}(meister),function(e){e.factory("ClaimsService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.getList=function(){return e.get(t+"/claims")},o.getListDetails=function(){return e.get(t+"/claims/details")},o.getDetails=function(o){return e.get(t+"/claims/detail/"+o)},o.simulate=function(o){return e.get(t+'/claims/simulate?Json={"CLAIMNO":"'+o+'"}')},o.approve=function(o){var a="";return _.forEach(o,function(e){a+='{"CLAIMNO":"'+e+'"},'}),a=a.substring(0,a.length-1),e.get(t+"/claims/approve?Json=["+a+"]")},o}])}(meister),function(e){e.factory("ReportService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.getReports=function(){return e.get(t+"/reports")},o.getListReports=function(){return e.get(t+"/list_reports")},o.getDetails=function(o){return e.get(t+"/reports/detail/"+o)},o.schedule=function(o){return e.get(t+"/reports/schedule/"+o)},o.buildDataForGraphicReports=function(e){var t=_.groupBy(e,function(e){return e.PstngDate}),o={labels:[],data:[]};return _.each(t,function(e,t){o.labels.push(t);var a=0;_.each(e,function(e){a+=Number(e.Quantity.replace("-",""))}),o.data.push(a)}),o},o}])}(meister),function(e){e.factory("SalesOrderService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.execute=function(o,a){return e.get(t+"/demo/execute?Endpoint="+o+"&Json="+a)},o}])}(meister),function(e){e.controller("AboutController",["$scope",function(e){}])}(meister),function(e){e.controller("ClaimDetailsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","ClaimsService",function(e,t,o,a,r,i,n,l,s){e.claim={},e.tabSelected=1,e.is_simulated=!1,e.simulations=[],e.isMobileDevice=r("xs"),e.init=function(){console.log(l),e.promise=s.getDetails(l.claimno),e.promise.then(function(t){if(console.log("ClaimsService.getDetails",t),e.claim=t.data,e.isMobileDevice){var o=[];_.forEach(e.claim.BUDGETS,function(t){t.WBS_ELEMENT==e.claim.APPRAISAL.WBS&&o.push(t)}),e.claim.BUDGETS=o}},function(e){console.log("failure loading claim details",e)})},_.forEach(e.budgets,function(e){e.$show=!1}),e.simulate=function(){e.promise2=s.simulate(l.claimno),e.promise2.then(function(t){if(e.is_simulated=!0,console.log("ClaimsService.simulate",t),t.data&&t.data.length>0&&(e.simulations=t.data[0],e.isMobileDevice)){var o=[];_.forEach(e.simulations,function(t){t.WBS_ELEMENT==e.claim.APPRAISAL.WBS&&o.push(t)}),e.simulations=o}},function(e){console.log("failure loading claim simulate",e)})},e.aproveConfirm=function(t){var o=n.confirm().title("You are about to Approve the following").textContent("You are about to Approve Claim No "+l.claimno).targetEvent(t).ok("Aprove").cancel("cancel");n.show(o).then(function(){e.aprove(t)},function(){e.status="You decided to keep your debt."})},e.aprove=function(t){var o=[];o.push(l.claimno),e.promise3=s.approve(o),e.promise3.then(function(o){console.log("ClaimsService.approve",o),n.show(n.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Claim "+l.claimno+" is Approved").ok("Ok").targetEvent(t)).then(function(){a.go("claims",{filters:[e.claim]})})},function(e){console.log("failure loading claim simulate",e)})}}])}(meister),function(e){e.controller("ClaimsController",["$scope","$timeout","$mdSidenav","$mdMedia","$mdMenu","$state","$stateParams","$mdDialog","ClaimsService",function(e,t,o,a,r,i,n,l,s){function c(e){return function(){o(e).toggle()}}e.toggleLeft=c("left"),e.toggleRight=c("right"),e.claims=[],e.claims_details=[],e.total=null,e.selected=[],e.isMobileDevice=a("xs"),e.gotoClaimDetails=function(e){0!=e.ACCEPTED&&i.go("claim-details",{claimno:e.CLAIM})},e.init=function(t){console.log("init",t),console.log("params",n),e.total=null,e.claims=[],e.claims_details=[],e.promise1=s.getList(),e.promise2=s.getListDetails();var o=[];t&&e.selected.length>0&&(o=angular.copy(e.selected),e.selected=[]),e.promise1.then(function(t){console.log("ClaimsService.getList",t),_.forEach(t.data.data,function(a){if(o.length>0){var r=_.find(o,function(e){return e.WBS==a.WBS});r?t.data.total-=a.total:e.claims.push(a)}else if(n.filters.length>0){var r=_.find(n.filters,function(e){return e.APPRAISAL.WBS==a.WBS});r?t.data.total-=a.total:e.claims.push(a)}else e.claims.push(a)}),e.total=t.data.total},function(e){console.log("failure loading claims",e)}),e.promise2.then(function(t){console.log("ClaimsService.getListDetails",t),_.forEach(t.data.data,function(t){if(o.length>0){var a=_.find(o,function(e){return e.WBS==t.WBS});a||e.claims_details.push(t)}else if(n.filters.length>0){var a=_.find(n.filters,function(e){return e.APPRAISAL.WBS==t.WBS});a||e.claims_details.push(t)}else e.claims_details.push(t)})},function(e){console.log("failure loading claims details",e)})},e.showDetails=function(e){console.log("showDetails",e),e.$showTooltip=!0},e.hideDetails=function(e){console.log("hideDetails",e),e.$showTooltip=!1},e.showDetails2=function(e){console.log("showDetails",e),e.$showTooltip2=!0},e.hideDetails2=function(e){console.log("hideDetails",e),e.$showTooltip2=!1},e.aproveConfirm=function(t){console.log("Approve items selected",e.selected);var o="",a=[];_.forEach(e.selected,function(e){a.push(e.CLAIM),o+="Claim "+e.CLAIM+" on WBS "+e.WBS+" for amount $"+e.ACCEPTED.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")+"<br/>"});var r=l.confirm().title("You are about to Approve the following").htmlContent(o).targetEvent(t).ok("Aprove").cancel("cancel");l.show(r).then(function(){e.aprove(t,a)},function(){e.status="You decided to keep your debt."})},e.aprove=function(t,o){e.promise3=s.approve(o),e.promise3.then(function(o){console.log("ClaimsService.approve",o),l.show(l.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Selected Claims are Approved").ok("Ok").targetEvent(t)).then(function(){e.init(!0)})},function(e){console.log("failure loading claim simulate",e)})}}])}(meister),function(e){e.controller("HomeController",["$scope","$rootScope","$timeout","$mdSidenav","$mdMenu","$state",function(e,t,o,a,r,i){function n(e){return function(){a(e).toggle()}}e.toggleLeft=n("left"),e.toggleRight=n("right"),t.gotoHome=function(){t.transition="fade-in",i.go("home")},t.gotoClaims=function(){i.go("claims")},t.gotoSalesOrder=function(){i.go("sales_order")},t.gotoMainReports=function(){i.go("reports")},t.openMenu=function(e,t){e(t)},t.transition="fade-in"}])}(meister),function(e){e.controller("LoginController",["$scope","$rootScope","$location","AuthenticationService",function(e,t,o,a){a.ClearCredentials(),e.login=function(){a.Login(e.username,e.password,function(t){t.success?(a.SetCredentials(e.username,e.password),o.path("/")):e.error=t.message})}}])}(meister),function(e){e.controller("ReportsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","$mdToast","ReportService",function(e,t,o,a,r,i,n,l,s,c){e.isMobileDevice=r("xs"),e.reports=[],e.list_reports=[],e.report="",e.selected=[],e.init=function(){e.promise2=c.getListReports(),e.promise2.then(function(t){console.log("ReportService.getListReports",t),e.list_reports=t.data,e.list_reports.length>0&&(e.reports.push(e.list_reports[0]),e.report=e.list_reports[0].REPORT_NAME)},function(e){console.log("failureReportService.getListReports",e)})},e.schedule=function(t,o){console.log("schedule",o),n.show(n.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Schedule Report successfull").textContent("Schedule Report success").ok("Ok").targetEvent(t)).then(function(){e.promise=c.schedule(o),e.promise.then(function(t){console.log("ReportService.schedule",t),e.init()},function(e){console.log("ReportService.schedule",e)})})},e.gotoReportSummary=function(e){"F"==e.STATUS?a.go("reports-summary",{PKY:e.PKY,reportName:e.REPORT_NAME}):s.show(s.simple().textContent("Report output is being prepared. Check back in a few minutes.").position("bottom").hideDelay(3e3))}}])}(meister),function(e){e.controller("ReportSummaryController",["$scope","$state","$mdMedia","$mdDialog","$stateParams","$timeout","ReportService",function(e,t,o,a,r,i,n){e.data=[],e.chartType="bar",e.isMobileDevice=o("xs"),e.chartData=[],e.labels=[],e.report_name="",e.filterDate="",e.chartOptions={onClick:function(t){var o=this.getElementAtEvent(t);if(o.length){var a=o[0]._index;i(function(){e.filterDate=e.labels[a]}),console.log(e.filterDate)}}},e.init=function(){console.log(r.PKY),e.report_name=r.reportName,e.promise=n.getDetails(r.PKY),e.promise.then(function(t){e.data=t.data,e.generateChart()},function(e){console.log("failure loading report details",e)})},e.gotoReports=function(){t.go("reports")},e.generateChart=function(){var t=n.buildDataForGraphicReports(e.data);e.chartData=t.data,e.labels=t.labels},e.removeFilters=function(){e.filterDate=""}}])}(meister),function(e){e.controller("SalesOrderController",["$scope","$rootScope","$timeout","$mdSidenav","$mdMenu","$state","SalesOrderService",function(e,t,o,a,r,i,n){function l(e,t){return diff=Math.abs(e-t),ms=diff%1e3,diff=(diff-ms)/1e3,ss=diff%60,diff=(diff-ss)/60,mm=diff%60,diff=(diff-mm)/60,hh=diff%24,days=(diff-hh)/24,"Execution time "+hh+"."+mm+"."+ss+"."+ms+" hrs.min.sec.msec"}e.shipToArray=[{label:"3000 - Smith Inc. LLC",value:"3000"}],e.soldToArray=[{label:"3000 - Smith Inc. LLC",value:"3000"}],e.payerArray=[{label:"3050 - Bush Holdings, Inc.",value:"3050"}],e.organizationArray=[{label:"3000 - USA Philadelphia",value:"3000"}],e.channelArray=[{label:"10 - Final customer sales",value:"10"}],e.divisionArray=[{label:"00 - Cross-division ",value:"00"}],e.officeArray=[{label:"3010 - Office Chicago",value:"3010"}],e.groupArray=[{label:"311 - Group C1",value:"311"}],e.shipToSelected="",e.shipTo2Selected="",e.soldToSelected="",e.payerSelected="",e.organizarionSelected="",e.channelSelected="",e.divisionSelected="",e.officeSelected="",e.groupSelected="",e.multiplier=10,e.materialCatalog=[],e.log="",e.changeShipTo=function(t){if(""!=t){var o='{"VENDOR":"'+t+'","PLANT":"'+t+'","PURORG":"'+t+'"}';e.log="Executing Get Catalog<br/>"+e.log;var a=new Date;e.materialCatalogProgress=n.execute("Meister.Demo.Po.Mat.Catalog",o),e.materialCatalogProgress.then(function(t){var o=new Date;console.log("SalesOrderService.execute result",t),e.log="Completed Get Catalog<br/>"+e.log,e.log=l(a,o)+"<br/>"+e.log,e.materialCatalog=t.data.Json},function(e){console.log("SalesOrderService.execute failure",e)})}}}])}(meister);