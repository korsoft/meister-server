var meister=angular.module("meister",["ngMaterial","ngAnimate","ngSanitize","ngMessages","ngAria","ui.router","ngCookies","md.data.table","chart.js"]);meister.constant("SERVER_BASE_URL","http://localhost:8000/api"),function(t){t.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/login"),t.state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"LoginController"}).state("home",{url:"/",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("about",{url:"/about",templateUrl:"partials/about-partial.html",controller:"AboutController"}).state("claims",{url:"/claims",templateUrl:"partials/claims-partial.html",controller:"ClaimsController",params:{filters:[]}}).state("reports",{url:"/reports",templateUrl:"partials/reports-partial.html",controller:"ReportsController",params:{filters:[]}}).state("claim-details",{url:"/claims-details",templateUrl:"partials/claim-details-partial.html",controller:"ClaimDetailsController",params:{claimno:""}}).state("reports-summary",{url:"/reports-summary",templateUrl:"partials/reports-summary-partial.html",controller:"ReportSummaryController",params:{PKY:"",reportName:""}})}]).run(["$rootScope","$location","$cookieStore","$http",function(t,e,o,n){t.globals=o.get("globals")||{},t.globals.currentUser&&(n.defaults.headers.common.Authorization="Basic "+t.globals.currentUser.authdata),t.$on("$locationChangeStart",function(o,n,i){"/login"===e.path()||t.globals.currentUser||e.path("/")})}])}(meister),function(t){t.factory("AuthenticationService",["Base64","$http","$cookieStore","$rootScope","$timeout",function(t,e,o,n,i){var a={};return a.Login=function(t,e,o){i(function(){var n={success:"arosenthal"===t&&"Pa55word."===e};n.success||(n.message="Username or password is incorrect"),o(n)},1e3)},a.SetCredentials=function(i,a){var r=t.encode(i+":"+a);n.globals={currentUser:{username:i,authdata:r}},e.defaults.headers.common.Authorization="Basic "+r,o.put("globals",n.globals)},a.ClearCredentials=function(){n.globals={},o.remove("globals"),e.defaults.headers.common.Authorization="Basic "},a}]).factory("Base64",function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var o,n,i,a,r,l="",s="",c="",u=0;do{o=e.charCodeAt(u++),n=e.charCodeAt(u++),s=e.charCodeAt(u++),i=o>>2,a=(3&o)<<4|n>>4,r=(15&n)<<2|s>>6,c=63&s,isNaN(n)?r=c=64:isNaN(s)&&(c=64),l=l+t.charAt(i)+t.charAt(a)+t.charAt(r)+t.charAt(c),o=n=s="",i=a=r=c=""}while(u<e.length);return l},decode:function(e){var o,n,i,a,r,l="",s="",c="",u=0;/[^A-Za-z0-9\+\/\=]/g.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i=t.indexOf(e.charAt(u++)),a=t.indexOf(e.charAt(u++)),r=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),o=i<<2|a>>4,n=(15&a)<<4|r>>2,s=(3&r)<<6|c,l+=String.fromCharCode(o),64!=r&&(l+=String.fromCharCode(n)),64!=c&&(l+=String.fromCharCode(s)),o=n=s="",i=a=r=c=""}while(u<e.length);return l}}})}(meister),function(t){t.factory("apiUtils",["$http","SERVER_BASE_URL",function(t,e){var o=e,n=function(t,e,n,i){var a={};return a.method=t,a.url=o+e,a.params=n||{},i&&(a.data=i),a},i={};return i.get=function(e,o,i){var a=n("GET",e,o,null);t(a).then(function(t){i(null,t.data)},function(t){i(t,null)})},i.post=function(e,o,i){var a=n("POST",e,null,o);t(a).then(function(t){i(null,t.data)},function(t){i(t,null)})},i.put=function(e,o,i){var a=n("PUT",e,null,o);t(a).then(function(t){i(null,t.data)},function(t){i(t,null)})},i.del=function(e,o,i){var a=n("DELETE",e,o,i);t(a).then(function(t){i(null,t.data)},function(t){i(t,null)})},i}])}(meister),function(t){t.factory("ClaimsService",["$http","SERVER_BASE_URL",function(t,e){var o={};return o.getList=function(){return t.get(e+"/claims")},o.getListDetails=function(){return t.get(e+"/claims/details")},o.getDetails=function(o){return t.get(e+"/claims/detail/"+o)},o.simulate=function(o){return t.get(e+'/claims/simulate?Json={"CLAIMNO":"'+o+'"}')},o.approve=function(o){var n="";return _.forEach(o,function(t){n+='{"CLAIMNO":"'+t+'"},'}),n=n.substring(0,n.length-1),t.get(e+"/claims/approve?Json=["+n+"]")},o}])}(meister),function(t){t.factory("ReportService",["$http","SERVER_BASE_URL",function(t,e){var o={};return o.getReports=function(){return t.get(e+"/reports")},o.getListReports=function(){return t.get(e+"/list_reports")},o.getDetails=function(o){return t.get(e+"/reports/detail/"+o)},o.schedule=function(o){return t.get(e+"/reports/schedule/"+o)},o.buildDataForGraphicReports=function(t){var e=_.groupBy(t,function(t){return t.PstngDate}),o={labels:[],data:[]};return _.each(e,function(t,e){o.labels.push(e);var n=0;_.each(t,function(t){n+=Number(t.Quantity.replace("-",""))}),o.data.push(n)}),o},o}])}(meister),function(t){t.controller("AboutController",["$scope",function(t){}])}(meister),function(t){t.controller("ClaimDetailsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","ClaimsService",function(t,e,o,n,i,a,r,l,s){t.claim={},t.tabSelected=1,t.is_simulated=!1,t.simulations=[],t.isMobileDevice=i("xs"),t.init=function(){console.log(l),t.promise=s.getDetails(l.claimno),t.promise.then(function(e){if(console.log("ClaimsService.getDetails",e),t.claim=e.data,t.isMobileDevice){var o=[];_.forEach(t.claim.BUDGETS,function(e){e.WBS_ELEMENT==t.claim.APPRAISAL.WBS&&o.push(e)}),t.claim.BUDGETS=o}},function(t){console.log("failure loading claim details",t)})},_.forEach(t.budgets,function(t){t.$show=!1}),t.simulate=function(){t.promise2=s.simulate(l.claimno),t.promise2.then(function(e){if(t.is_simulated=!0,console.log("ClaimsService.simulate",e),e.data&&e.data.length>0&&(t.simulations=e.data[0],t.isMobileDevice)){var o=[];_.forEach(t.simulations,function(e){e.WBS_ELEMENT==t.claim.APPRAISAL.WBS&&o.push(e)}),t.simulations=o}},function(t){console.log("failure loading claim simulate",t)})},t.aproveConfirm=function(e){var o=r.confirm().title("You are about to Approve the following").textContent("You are about to Approve Claim No "+l.claimno).targetEvent(e).ok("Aprove").cancel("cancel");r.show(o).then(function(){t.aprove(e)},function(){t.status="You decided to keep your debt."})},t.aprove=function(e){var o=[];o.push(l.claimno),t.promise3=s.approve(o),t.promise3.then(function(o){console.log("ClaimsService.approve",o),r.show(r.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Claim "+l.claimno+" is Approved").ok("Ok").targetEvent(e)).then(function(){n.go("claims",{filters:[t.claim]})})},function(t){console.log("failure loading claim simulate",t)})}}])}(meister),function(t){t.controller("ClaimsController",["$scope","$timeout","$mdSidenav","$mdMedia","$mdMenu","$state","$stateParams","$mdDialog","ClaimsService",function(t,e,o,n,i,a,r,l,s){function c(t){return function(){o(t).toggle()}}t.toggleLeft=c("left"),t.toggleRight=c("right"),t.claims=[],t.claims_details=[],t.total=null,t.selected=[],t.isMobileDevice=n("xs"),t.gotoClaimDetails=function(t){0!=t.ACCEPTED&&a.go("claim-details",{claimno:t.CLAIM})},t.init=function(e){console.log("init",e),console.log("params",r),t.total=null,t.claims=[],t.claims_details=[],t.promise1=s.getList(),t.promise2=s.getListDetails();var o=[];e&&t.selected.length>0&&(o=angular.copy(t.selected),t.selected=[]),t.promise1.then(function(e){console.log("ClaimsService.getList",e),_.forEach(e.data.data,function(n){if(o.length>0){var i=_.find(o,function(t){return t.WBS==n.WBS});i?e.data.total-=n.total:t.claims.push(n)}else if(r.filters.length>0){var i=_.find(r.filters,function(t){return t.APPRAISAL.WBS==n.WBS});i?e.data.total-=n.total:t.claims.push(n)}else t.claims.push(n)}),t.total=e.data.total},function(t){console.log("failure loading claims",t)}),t.promise2.then(function(e){console.log("ClaimsService.getListDetails",e),_.forEach(e.data.data,function(e){if(o.length>0){var n=_.find(o,function(t){return t.WBS==e.WBS});n||t.claims_details.push(e)}else if(r.filters.length>0){var n=_.find(r.filters,function(t){return t.APPRAISAL.WBS==e.WBS});n||t.claims_details.push(e)}else t.claims_details.push(e)})},function(t){console.log("failure loading claims details",t)})},t.showDetails=function(t){console.log("showDetails",t),t.$showTooltip=!0},t.hideDetails=function(t){console.log("hideDetails",t),t.$showTooltip=!1},t.showDetails2=function(t){console.log("showDetails",t),t.$showTooltip2=!0},t.hideDetails2=function(t){console.log("hideDetails",t),t.$showTooltip2=!1},t.aproveConfirm=function(e){console.log("Approve items selected",t.selected);var o="",n=[];_.forEach(t.selected,function(t){n.push(t.CLAIM),o+="Claim "+t.CLAIM+" on WBS "+t.WBS+" for amount $"+t.ACCEPTED.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")+"<br/>"});var i=l.confirm().title("You are about to Approve the following").htmlContent(o).targetEvent(e).ok("Aprove").cancel("cancel");l.show(i).then(function(){t.aprove(e,n)},function(){t.status="You decided to keep your debt."})},t.aprove=function(e,o){t.promise3=s.approve(o),t.promise3.then(function(o){console.log("ClaimsService.approve",o),l.show(l.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Selected Claims are Approved").ok("Ok").targetEvent(e)).then(function(){t.init(!0)})},function(t){console.log("failure loading claim simulate",t)})}}])}(meister),function(t){t.controller("HomeController",["$scope","$rootScope","$timeout","$mdSidenav","$mdMenu","$state",function(t,e,o,n,i,a){function r(t){return function(){n(t).toggle()}}t.toggleLeft=r("left"),t.toggleRight=r("right"),e.gotoHome=function(){e.transition="fade-in",a.go("home")},e.gotoClaims=function(){a.go("claims")},e.gotoMainReports=function(){a.go("reports")},e.openMenu=function(t,e){t(e)},e.transition="fade-in"}])}(meister),function(t){t.controller("LoginController",["$scope","$rootScope","$location","AuthenticationService",function(t,e,o,n){n.ClearCredentials(),t.login=function(){n.Login(t.username,t.password,function(e){e.success?(n.SetCredentials(t.username,t.password),o.path("/")):t.error=e.message})}}])}(meister),function(t){t.controller("ReportsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","$mdToast","ReportService",function(t,e,o,n,i,a,r,l,s,c){t.isMobileDevice=i("xs"),t.reports=[],t.list_reports=[],t.report="",t.selected=[],t.init=function(){t.promise=c.getReports(),t.promise2=c.getListReports(),t.promise.then(function(e){var o=!0;angular.forEach(e.data.d.results,function(e,n){var i=angular.fromJson(e.Json);t.reports.push(i),o&&(t.report=i.REPORT_NAME,o=!1)})},function(t){console.log("failureReportService.getReports",t)}),t.promise2.then(function(e){console.log("ReportService.getListReports",e),t.list_reports=e.data},function(t){console.log("failureReportService.getListReports",t)})},t.schedule=function(e,o){console.log("schedule",o),r.show(r.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Schedule Report successfull").textContent("Schedule Report success").ok("Ok").targetEvent(e)).then(function(){t.promise=c.schedule(o),t.promise.then(function(t){console.log("ReportService.schedule",t)},function(t){console.log("ReportService.schedule",t)})})},t.gotoReportSummary=function(t){"F"==t.STATUS?n.go("reports-summary",{PKY:t.PKY,reportName:t.REPORT_NAME}):s.show(s.simple().textContent("Report output is being prepared. Check back in a few minutes.").position("bottom").hideDelay(3e3))}}])}(meister),function(t){t.controller("ReportSummaryController",["$scope","$state","$mdMedia","$mdDialog","$stateParams","$timeout","ReportService",function(t,e,o,n,i,a,r){t.data=[],t.chartType="bar",t.isMobileDevice=o("xs"),t.chartData=[],t.labels=[],t.report_name="",t.filterDate="",t.chartOptions={onClick:function(e){var o=this.getElementAtEvent(e);if(o.length){var n=o[0]._index;a(function(){t.filterDate=t.labels[n]}),console.log(t.filterDate)}}},t.init=function(){console.log(i.PKY),t.report_name=i.reportName,t.promise=r.getDetails(i.PKY),t.promise.then(function(e){t.data=e.data,t.generateChart()},function(t){console.log("failure loading report details",t)})},t.gotoReports=function(){e.go("reports")},t.generateChart=function(){var e=r.buildDataForGraphicReports(t.data);t.chartData=e.data,t.labels=e.labels},t.removeFilters=function(){t.filterDate=""}}])}(meister);